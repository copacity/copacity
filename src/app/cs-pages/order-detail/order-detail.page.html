<ion-header>
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button (click)="close()">
        <i class="fa fa-times" style="font-size: 1.8em;"></i>
      </ion-button>
    </ion-buttons>
    <ion-title style="font-size: x-large;">
      <a style="color: white;" class="header-title bold"><span style="color: white;padding-left: 10px;">#</span>
        {{ order?.ref }}</a>
      <!-- <span style="padding-left: 5px;font-size: medium;">{{store?.name}}</span> -->
    </ion-title>
  </ion-toolbar>

</ion-header>

<div class="profile-popover bottom-30">
  <div class="profile-header">
  </div>
  <div class="profile-header-clear" style="height: 0px;margin: 0px 0px 0px 0px;">
  </div>
  <div class="profile-body-no-apply">
    <div id="page">
      <div class="content header-clear-small">
        <label style="padding-bottom: 20px;padding-left: 10px;"><b>Estado:</b>
          {{ order?.status | orderStatusName }}</label>
        <label *ngIf="(order && order.messageRejected)" style="padding-bottom: 20px;padding-left: 10px;"><b>Motivo:</b>
          {{ order?.messageRejected  }}</label>
        <div class="user-list-left" *ngIf="appService.currentUser?.id!=user?.id">
          <img [src]="user?.photoUrl?user?.photoUrl:'../../../assets/icon/no-image.png'" alt="img" class="shadow-small">
          <h4 style="top:-15px">{{user?.name}} </h4>
          <div class="divider" class="top-10"></div>
          <label *ngIf="(order && order.message)" style="padding-bottom: 20px;padding-left: 10px;"><b>Comentario:</b>
            {{ order?.message  }}</label>
          <table style="width: 100%;">
            <tr>
              <td>
                <div class="link-list link-list-3" style="text-align: left;">
                  <a href="tel:{{user?.phone1}}" class="round-small shadow-tiny">
                    <i class="fa fa-phone" style="color: green;"></i>
                    <span style="font-size: 18px;">{{user?.phone1}}</span>
                  </a>
                </div>
              </td>
              <td>
                <div class="link-list link-list-3" style="text-align: left;">
                  <a href="tel:{{user?.phone2}}" class="round-small shadow-tiny">
                    <i class="fa fa-phone" style="color: green;"></i>
                    <span style="font-size: 18px;">{{user?.phone2}}</span>
                  </a>
                </div>
              </td>
            </tr>
          </table>
          <a href="https://wa.me/57{{user?.whatsapp}}" class="next-slide-user"
            style="font-size: 2.5em;top:-15px;height: 40px;font-weight: 100;">
            <i class="fab fa-whatsapp" style="color: green;padding-top: 2px;"></i></a>
        </div>
        <div *ngIf="(order?.status == 1) && (appService.currentUser?.id!=user?.id)"
          class="content content-box shadow-large round-small bg-highlight">
          <p class="color-white bottom-10" style="font-size: 18px;">
            Si algún producto en la lista está agotado en tu tienda, puedes dar click al <i style="font-size: 1.5em;"
              class="fa fa-check-square"> </i> del producto para descartarlo y recalcular el Total
          </p>
        </div>

        <table class="table-borders" style="font-size: 18px;">
          <tr>
            <th></th>
            <th style="text-align: left; padding-left: 5px;">Producto</th>
            <th style="width: 20px;">#</th>
            <th>Total</th>
          </tr>
          <tr *ngFor="let cartProduct of cartProducts | async">
            <td style="text-align: left; padding-left: 5px;vertical-align: top">
              <ion-checkbox disabled="{{(order?.status == 1 && appService.currentUser?.id!=user?.id)?'false':'true'}}"
                (ionChange)="checkProduct($event, cartProduct)" checked="{{cartProduct.checked}}"
                style="width: 30px; height: 30px;"></ion-checkbox>
            </td>
            <td style="text-align: left; padding-left: 5px;" class="{{(!cartProduct.checked)?'unchecked':''}}">
              {{cartProduct.product.name}},<span *ngFor="let property of cartProduct.propertiesSelection;"
                style="font-size: .7em;font-weight: 700;color: blue;">, {{property.propertyName }}:
                {{property.propertyOptionName }} </span><small
              style="font-size: 12px;font-weight: 900;">({{cartService.getProductSubTotalUnity(cartProduct) | currency: 'USD' : 'symbol' : '1.0-0'}})</small>
              <small *ngIf="cartProduct.product?.discount && cartProduct.product?.discount > 0"
                style="font-size: 12px;font-weight: 700;color: black;background-color: yellow;">
                (-{{cartProduct.product.discount}}%) </small>
            </td>
            <td class="{{(!cartProduct.checked)?'unchecked':''}}">{{cartProduct.quantity}}</td>
            <td class="color-green1-dark {{(!cartProduct.checked)?'unchecked':''}}">
              {{ cartService.getProductTotal(cartProduct) | currency: 'USD' : 'symbol' : '1.0-0'}}</td>
          </tr>
        </table>
      </div>

      <div style="margin: 10px 15px 5px 15px;font-size: 18px;">
        <!-- <div class="store-cart-total">
          <strong>Subtotal</strong>
          <span>{{ getSubTotal() | currency: 'USD' : 'symbol' : '1.0-0' }}</span>
          <div class="clear"></div>
        </div> -->
        <div class="store-cart-total">
          <strong>Domicilio</strong>
          <span>{{ store?.deliveryPrice | currency: 'USD' : 'symbol' : '1.0-0'}}</span>
          <div class="clear"></div>
        </div>
        <div class="store-cart-total">
          <strong class="color-highlight">Ahorraste</strong>
          <span class="color-highlight">{{ cartService.getDiscountDetail()  | currency: 'USD' : 'symbol' : '1.0-0' }}</span>
          <div class="clear"></div>
        </div>
        <div class="divider bg-green1-light opacity-350"></div>
        <div class="store-cart-total bottom-20" style="font-size: 25px;">
          <strong class="uppercase bold">Total</strong>
          <span class="uppercase bold">{{ cartService.getTotalDetail(store?.deliveryPrice)  | currency: 'USD' : 'symbol' : '1.0-0' }}</span>
          <div class="clear"></div>
        </div>
      </div>

      <div style="background-color: red;" class="divider opacity-350"></div>
      <div class="content content-box">
        <h2 class="color-black bold top-10">Direccion de envio</h2>
        <table class="table-borders" style="font-size: 18px;">
          <tr *ngFor="let address of addresses | async">
            <td style="text-align: left;vertical-align: top;">
              <table style="font-size: 1em;margin-bottom: 0px;">
                <tr>
                  <td style="text-align: left;"><b>Nombre:</b> {{address?.name}}</td>
                </tr>
                <tr>
                  <td style="text-align: left;"><b>Apellido: </b> {{ address?.lastName }}</td>
                </tr>
                <tr>
                  <td style="text-align: left;"><b>Tel: </b> {{ address?.phone1 }}</td>
                </tr>
                <tr>
                  <td style="text-align: left;"><b>Tel2: </b> {{ address?.phone2 }}</td>
                </tr>
                <!-- <tr>
                  <td style="text-align: left;"><b>Sector: </b> {{ address?.idSector | sectorName }}</td>
                </tr> -->
                <tr>
                  <td style="text-align: left;"><b>Direccion: </b> {{ address?.address }}</td>
                </tr>
                <tr>
                  <td style="text-align: left;"><b>Descripcion: </b>{{ address?.description }}</td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </div>

      <ion-grid style="padding-left: 5px; padding-right: 5px;padding-bottom: 5px;">
        <ion-row>
          <ion-col>
            <a *ngIf="(order?.status == 1 && appService.currentUser?.id!=user?.id)" (click)="openMessage($event)"
              style="color:white;font-size: 15px;font-weight: bold;padding: 12px;margin: 10px 15px 10px 15px;"
              class="button bg-black button-round-small shadow-large button-full button-s">Rechazar Pedido</a>
            <!-- <a *ngIf="order?.status == 2" (click)="resendOrder()"
                style="color:white;font-size: 15px;font-weight: bold;padding: 12px;height: 45px;margin: 10px 15px 10px 15px;"
                class="button bg-green1-dark button-round-small shadow-large button-full button-s">Volver a pedir!</a> -->
          </ion-col>
          <ion-col>
            <a *ngIf="(order?.status == 1  && appService.currentUser?.id!=user?.id)" (click)="sendToClient()"
              style="color:white;font-size: 15px;font-weight: bold;padding: 12px;margin: 10px 15px 10px 15px;"
              class="button bg-green1-dark button-round-small shadow-large button-full button-s">Enviar Pedido al
              Cliente!</a>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
  </div>
</div>